create table roles
(
    id   bigserial
        primary key,
    name varchar(255) not null
);

alter table roles
    owner to tuanhoang;

create table nations
(
    id   bigserial
        primary key,
    name varchar(255) not null
);

alter table nations
    owner to tuanhoang;

create table users
(
    id            uuid                                not null
        primary key,
    email         varchar(255)                        not null,
    username      varchar(50)                         not null
        unique,
    password      varchar(255)                        not null,
    full_name     varchar(255)                        not null,
    is_active     boolean   default true,
    phone         varchar(20),
    date_of_birth date,
    last_login    timestamp,
    gender        varchar(10)
        constraint users_gender_check
            check ((gender)::text = ANY ((ARRAY ['male'::character varying, 'female'::character varying])::text[])),
    role_id       bigint
        constraint fk_role
            references roles,
    nation_id     bigint
        constraint fk_nation
            references nations,
    bio           text,
    is_verified   boolean   default false,
    title         varchar(100),
    avatar        text,
    created_at    timestamp default CURRENT_TIMESTAMP not null,
    updated_at    timestamp default CURRENT_TIMESTAMP not null,
    twofa_enabled boolean   default false
);

alter table users
    owner to tuanhoang;

create index idx_email
    on users (email);

create index idx_username
    on users (username);

create table refresh_tokens
(
    id         uuid                     default gen_random_uuid() not null
        primary key,
    token      text                                               not null,
    user_id    uuid                                               not null
        constraint fk_refresh_tokens_user
            references users
            on delete cascade,
    expires_at timestamp with time zone                           not null,
    created_at timestamp with time zone default now()
);

alter table refresh_tokens
    owner to tuanhoang;

